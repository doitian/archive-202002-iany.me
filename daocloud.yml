version: 2.0

test:
  image: buildpack-deps:scm
  script:
    - mkdir -p ~/.ssh
    - ssh-keyscan -t rsa -H github.com >> ~/.ssh/known_hosts
    - git remote add github git@github.com:doitian/iany.me.git
    - git push github $(git rev-parse --abbrev-ref HEAD)

build:
  lite_image:
    compile:
      dockerfile_path: Dockerfile
      build_dir: /
      cache: false
    extract:
      - /usr/src/app/Caddyfile
      - /usr/src/app/public
    package:
      dockerfile_path: Dockerfile.sec
      build_dir: /
      cache: true
